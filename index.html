<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solar Choices: On-Grid, Off-Grid & Net-Metering</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--ink:#0f172a;--muted:#64748b;--pill:#e2e8f0;}
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .tab-btn{border-bottom:2px solid transparent}
    .tab-btn[aria-selected="true"]{color:#0f172a;border-color:#0f172a;font-weight:700}
    .container-narrow{max-width:1100px}
    .hint{background:linear-gradient(0deg,#f8fafc,#fff);border:1px dashed #cbd5e1}
  </style>
</head>

<body class="bg-slate-50 text-slate-800">
  <!-- Header -->
  <header class="bg-white border-b border-slate-200">
    <div class="mx-auto container-narrow px-6 py-6">
      <h1 class="text-2xl md:text-3xl font-bold">Solar Choices: On-Grid, Off-Grid & Net-Metering</h1>
      <p class="text-slate-600 mt-1">Understand your options, explore policy trade-offs, and run numbers with an interactive tool.</p>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="mx-auto container-narrow px-6 pt-4">
    <div id="tabs" class="flex flex-wrap gap-3">
      <button class="tab-btn px-3 pb-2" data-tab="overview" aria-selected="true">Overview</button>
      <button class="tab-btn px-3 pb-2" data-tab="net" aria-selected="false">How Net Metering Works</button>
      <button class="tab-btn px-3 pb-2" data-tab="cases" aria-selected="false">Case Studies</button>
      <button class="tab-btn px-3 pb-2" data-tab="policy" aria-selected="false">Policy & Tips</button>
      <button class="tab-btn px-3 pb-2" data-tab="tool" aria-selected="false">Tool</button>
    </div>
  </nav>

  <!-- Content -->
  <main class="mx-auto container-narrow px-6 py-6 space-y-10">
    <!-- Overview -->
    <section id="panel-overview" class="space-y-4">
      <h2 class="text-xl font-semibold">Overview</h2>
      <p class="text-slate-700">
    This tool helps you compare two core design paths for residential and small-community solar systems:
    a <strong>net-zero grid-tied</strong> system and a <strong>fully off-grid</strong> system.
    Both can power the same load but differ in cost structure, reliability, and policy sensitivity.
  </p>

  <p class="text-slate-700">
    The calculator estimates <strong>CAPEX</strong> (upfront cost) and <strong>LCOE</strong> 
    (levelized cost of electricity ‚Äî the average $/kWh over the system‚Äôs life).
    Using your local irradiance, load, and component data, it automatically sizes panels, inverters, 
    and batteries, then computes energy balance, grid bills, and overall economics.
  </p>

  <div class="grid md:grid-cols-3 gap-4">
    <div class="rounded-xl bg-white border border-slate-200 p-4">
      <h3 class="font-semibold mb-1">Grid-Tied (Net-Zero)</h3>
      <p class="text-slate-600 text-sm">
        Designed to offset ~100% of annual energy use through grid exports and credits. 
        Uses the grid for backup ‚Äî no batteries required. 
        Lowest cost per kWh, but depends on policy (buy/sell rate and net-metering terms).
      </p>
    </div>

    <div class="rounded-xl bg-white border border-slate-200 p-4">
      <h3 class="font-semibold mb-1">Off-Grid</h3>
      <p class="text-slate-600 text-sm">
        Independent of the utility grid, with solar and batteries sized for multi-day autonomy. 
        Provides resilience and energy security but requires higher CAPEX, periodic battery replacements, 
        and careful load management.
      </p>
    </div>

    <div class="rounded-xl bg-white border border-slate-200 p-4">
      <h3 class="font-semibold mb-1">Decision Hook</h3>
      <p class="text-slate-600 text-sm">
        If grid extension is <strong>expensive or unavailable</strong>, off-grid may be cheaper overall 
        despite a higher LCOE. Otherwise, a grid-tied system provides faster payback and lower complexity.
      </p>
    </div>
  </div>

  <div class="rounded-xl bg-slate-50 border border-slate-200 p-4 space-y-2">
    <h3 class="font-semibold">When to Choose Each Path</h3>
    <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
      <li><strong>Choose Grid-Tied</strong> if the grid is available, export credit policies are fair, and reliability is high.</li>
      <li><strong>Choose Off-Grid</strong> if grid connection costs exceed ~$20‚Äì30k or reliability/outage risk is unacceptable.</li>
      <li><strong>Choose Hybrid</strong> (PV + small battery) if export credits are low and you want partial backup power.</li>
    </ul>
  </div>

  <div class="rounded-xl bg-white border border-slate-200 p-4">
    <h3 class="font-semibold mb-1">Key Metrics Explained</h3>
    <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
      <li><strong>CAPEX:</strong> Total upfront investment (panels, batteries, inverter, installation, and grid costs).</li>
      <li><strong>LCOE:</strong> Present-value cost of energy per kWh over system lifetime.</li>
      <li><strong>Autonomy:</strong> Number of days the system can operate without solar input (relevant for off-grid).</li>
      <li><strong>Payback:</strong> Years required for savings to equal initial investment (for grid-connected systems).</li>
    </ul>
  </div>

  <p class="text-xs text-slate-500">
    Content adapted for educational comparison; use time-series modeling (e.g., PVWatts, SAM) and actual tariffs for design accuracy.
  </p>
    </section>

    <!-- Net Metering -->
    <section id="panel-net" class="hidden space-y-4">
      <h2 class="text-xl font-semibold">How Net Metering Works</h2>
      <p class="text-slate-700">
    Net metering allows solar owners to stay connected to the utility grid while offsetting their electricity bills. 
    Your system‚Äôs meter tracks both <em>imports</em> (electricity you use from the grid) and <em>exports</em> 
    (excess energy you send back). The utility then applies credits to your bill based on these energy flows.
  </p>

  <div class="rounded-xl bg-white border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Step-by-Step Energy Flow</h3>
    <ol class="list-decimal pl-5 space-y-1 text-slate-700 text-sm">
      <li><strong>Generation:</strong> Your PV array produces DC power, converted to AC by the inverter.</li>
      <li><strong>Self-Use:</strong> The home consumes this solar power instantly when available.</li>
      <li><strong>Export:</strong> Surplus solar energy is exported to the grid and tracked by a bi-directional meter.</li>
      <li><strong>Credit:</strong> Each exported kWh earns a credit at the <em>sell rate</em> (¬¢/kWh).</li>
      <li><strong>Import:</strong> When production is low (night or cloudy days), power is imported from the grid at the <em>buy rate</em>.</li>
      <li><strong>True-Up:</strong> At month or year end, your total imports and exports are reconciled by the utility.</li>
    </ol>
  </div>

  <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Bill or Credit Calculation</h3>
    <p class="text-sm text-slate-700">
      The calculator uses these rates to determine your bill outcome:
    </p>
    <pre class="text-sm bg-white border border-slate-200 p-3 rounded-md overflow-x-auto">
Annual Bill ($) = (Import kWh √ó Buy Rate) ‚àí (Export kWh √ó Sell Rate)
    </pre>
    <p class="text-sm text-slate-600">
      If the result is positive ‚Üí you owe the utility.  
      If negative ‚Üí you receive a credit.  
      When <em>Annual Production ‚âà Annual Load</em>, the system achieves ‚ÄúNet Zero.‚Äù
    </p>
  </div>

  <div class="rounded-xl bg-white border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Example Scenario</h3>
    <p class="text-sm text-slate-700">
      Suppose a home uses <strong>10,000 kWh/yr</strong> and the PV system produces <strong>11,000 kWh/yr</strong>.  
      At a <strong>Buy Rate = $0.20/kWh</strong> and <strong>Sell Rate = $0.10/kWh</strong>:
    </p>
    <ul class="list-disc pl-6 text-sm text-slate-700 mt-2 space-y-1">
      <li>Export = 1,000 kWh ‚Üí credit of $100</li>
      <li>Import = 0 kWh ‚Üí no grid usage</li>
      <li>Annual Bill = ‚àí$100 (credit carried forward)</li>
    </ul>
    <p class="text-xs text-slate-500 mt-2">
      In this example, the household achieved net-positive generation; excess credits may roll over or expire depending on the utility‚Äôs true-up policy.
    </p>
  </div>

  <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Common Policy Variations</h3>
    <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
      <li><strong>Full Retail Credit:</strong> Exports valued at the same rate as imports (traditional NEM 1.0).</li>
      <li><strong>Avoided Cost Credit:</strong> Lower sell rate (reflects utility‚Äôs wholesale value, e.g. NEM 3.0).</li>
      <li><strong>Monthly True-Up:</strong> Credits reset each month, favoring self-consumption.</li>
      <li><strong>Annual True-Up:</strong> Credits roll for 12 months, good for seasonal solar regions.</li>
    </ul>
  </div>

  <div class="rounded-xl bg-white border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Tips for Optimization</h3>
    <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
      <li>Size PV slightly below total annual load if export credits are low.</li>
      <li>Use smart appliances or small batteries to shift solar use into evenings.</li>
      <li>Track local tariff updates‚Äîsmall changes in sell rate can change ROI.</li>
      <li>Compare hybrid (PV + battery) setups if you face low export rates.</li>
    </ul>
  </div>

  <p class="text-xs text-slate-500">
    Content adapted for educational comparison; always check your utility‚Äôs current net-metering and interconnection rules.
  </p>
    </section>

    <!-- Case Studies -->
    <section id="panel-cases" class="hidden space-y-6">
      <h2 class="text-xl font-semibold">Case Studies (Quick Read)</h2>

      <!-- Case 1 -->
  <div class="rounded-2xl bg-white border border-slate-200 p-5 space-y-2">
    <h3 class="font-semibold text-slate-800">1) Off-Grid Cabin (8 kW + 48 kWh)</h3>
    <p class="text-slate-700 text-sm">
      A remote cabin located 0.5 miles from the nearest grid line ‚Äî avoiding costly grid extension (~$50,000+). 
      The system includes an 8 kW PV array and a 48 kWh LiFePO‚ÇÑ battery bank providing ~2 days of autonomy.
    </p>

    <ul class="list-disc pl-5 text-sm text-slate-700 space-y-1">
      <li><strong>Load:</strong> 9,000 kWh / year (‚âà 25 kWh/day)</li>
      <li><strong>Irradiance:</strong> 4.5 kWh/m¬≤/day ‚Üí annual yield ‚âà 11,000 kWh</li>
      <li><strong>Storage:</strong> 48 kWh usable at 80% DoD; battery life ‚âà 12 years</li>
      <li><strong>System Cost:</strong> ~$45,000 (PV + batteries + inverters + install)</li>
      <li><strong>LCOE:</strong> ~$0.38 / kWh (higher due to storage replacement)</li>
    </ul>

    <p class="text-sm text-slate-700">
      Includes a 3 kW generator for winter reserve and backup. No grid bill, full autonomy, but higher upfront cost.
    </p>

    <div class="rounded-xl bg-slate-50 border border-slate-200 p-3 text-sm">
      <strong>Takeaway:</strong> Ideal for remote or resilience-driven sites. 
      Economic breakeven occurs when grid-extension cost &gt; $25 k‚Äì30 k.
    </div>
  </div>

  <!-- Case 2 -->
  <div class="rounded-2xl bg-white border border-slate-200 p-5 space-y-2">
    <h3 class="font-semibold text-slate-800">2) Net-Zero Suburban Roof (10 kW)</h3>
    <p class="text-slate-700 text-sm">
      A typical suburban home in a region with 5.0 kWh/m¬≤/day solar resource, annual load ‚âà 10,500 kWh. 
      The array is sized to generate ~ 110% of annual use, exporting surplus energy through net metering.
    </p>

    <ul class="list-disc pl-5 text-sm text-slate-700 space-y-1">
      <li><strong>Buy Rate:</strong> $0.20 / kWh</li>
      <li><strong>Sell Credit:</strong> $0.10 / kWh (NEM 3.0 policy)</li>
      <li><strong>System Cost:</strong> ~$23,000 (panels + inverter + install + permits)</li>
      <li><strong>LCOE:</strong> ~$0.23 / kWh</li>
      <li><strong>Payback:</strong> ~8 years with 30% ITC and current tariffs</li>
    </ul>

    <p class="text-sm text-slate-700">
      Export credits reduce bills significantly; homeowner reaches net-zero on annual basis, with grid backup maintained.
    </p>

    <div class="rounded-xl bg-slate-50 border border-slate-200 p-3 text-sm">
      <strong>Takeaway:</strong> Excellent ROI under supportive net-metering policies. 
      ROI declines if sell-credit &lt; 50% of buy rate.
    </div>
  </div>

  <!-- Case 3 -->
  <div class="rounded-2xl bg-white border border-slate-200 p-5 space-y-2">
    <h3 class="font-semibold text-slate-800">3) Hybrid Microgrid (6 kW + 15 kWh Battery)</h3>
    <p class="text-slate-700 text-sm">
      A semi-rural home uses a hybrid system that remains grid-connected but includes a small 15 kWh battery for evening use 
      and backup during outages. This setup balances economics and resilience.
    </p>

    <ul class="list-disc pl-5 text-sm text-slate-700 space-y-1">
      <li><strong>Load:</strong> 8,000 kWh / year</li>
      <li><strong>Irradiance:</strong> 5.5 kWh/m¬≤/day ‚Üí annual generation ‚âà 8,800 kWh</li>
      <li><strong>Battery:</strong> 15 kWh usable; 1 day autonomy</li>
      <li><strong>System Cost:</strong> ~$28,000 (PV + battery + inverter + install)</li>
      <li><strong>LCOE:</strong> ~$0.27 / kWh</li>
    </ul>

    <div class="rounded-xl bg-slate-50 border border-slate-200 p-3 text-sm">
      <strong>Takeaway:</strong> Balanced middle-ground for reliability and self-consumption; mitigates low sell-rate penalties.
    </div>
  </div>

  <p class="text-xs text-slate-500">
    Content adapted for educational comparison; use time-series simulation (e.g., PVWatts + tariff engine) for design validation.
  </p>
     
    </section>

    <!-- Policy -->
    <section id="panel-policy" class="hidden space-y-4">
      <h2 class="text-xl font-semibold">Policy Landscape & Practical Tips</h2>
     
  <p class="text-slate-700">
    Policy and tariff structures play a major role in determining whether a grid-tied, hybrid, or off-grid system makes 
    the most sense financially. Export credit values, interconnection fees, and incentives can shift payback periods by years. 
    This section outlines the key factors to monitor before committing to a system design.
  </p>

  <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">How Policy Impacts System Choice</h3>
    <ul class="list-disc pl-6 text-slate-700 text-sm space-y-1">
      <li><strong>Export Credits:</strong> Define how much you earn for each excess kWh sent to the grid. 
          Lower credits favor self-consumption and batteries.</li>
      <li><strong>Time-of-Use (TOU) Tariffs:</strong> Electricity prices vary by time of day; exporting midday solar at 
          low value and importing in the evening at high value can erode savings.</li>
      <li><strong>Net Billing vs Net Metering:</strong> Under net billing, exports are valued lower than imports; under 
          net metering, they are typically equal. Know your local policy.</li>
      <li><strong>Incentives & Tax Credits:</strong> Federal or state incentives can reduce upfront CAPEX by 20‚Äì40%, 
          improving LCOE for both grid-tied and off-grid systems.</li>
    </ul>
  </div>

  <div class="grid md:grid-cols-3 gap-4">
    <div class="rounded-xl bg-white border border-slate-200 p-4">
      <h3 class="font-semibold mb-1">Check Tariffs</h3>
      <p class="text-slate-600 text-sm">
        Review your utility‚Äôs <em>time-of-use</em> and <em>export credit</em> rates. 
        A favorable net-metering policy (1:1 buy/sell) makes grid-tie more cost-effective; 
        under reduced export credits (e.g., 30‚Äì50% of buy rate), battery self-use becomes more valuable.
      </p>
    </div>

    <div class="rounded-xl bg-white border border-slate-200 p-4">
      <h3 class="font-semibold mb-1">Backup Value</h3>
      <p class="text-slate-600 text-sm">
        Adding even a small 10‚Äì15 kWh battery can shift self-consumption into high-value hours, 
        reduce exposure to TOU rates, and provide outage resilience ‚Äî often improving payback 
        under NEM 3.0 or net billing frameworks.
      </p>
    </div>

    <div class="rounded-xl bg-white border border-slate-200 p-4">
      <h3 class="font-semibold mb-1">Extension Cost</h3>
      <p class="text-slate-600 text-sm">
        For remote sites, compare the total cost of extending grid service (distance √ó $/ft) 
        with the CAPEX of an off-grid solar + battery system. If extension cost exceeds $25k‚Äì$40k, 
        off-grid autonomy often becomes economically favorable despite higher LCOE.
      </p>
    </div>
  </div>

  <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Practical Steps Before Installation</h3>
    <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
      <li>Contact your utility or regulator to confirm the latest <strong>net-metering and interconnection policy</strong>.</li>
      <li>Model your expected <strong>export/import balance</strong> using average daily load and irradiance.</li>
      <li>Evaluate <strong>hybrid (PV + battery)</strong> setups if your export credit is below 50% of your buy rate.</li>
      <li>Account for <strong>permit, interconnect, and maintenance fees</strong> in the CAPEX estimate.</li>
      <li>Lock in your <strong>net-metering terms</strong> before policy revisions ‚Äî grandfathered rates can preserve ROI.</li>
    </ul>
  </div>

  <div class="rounded-xl bg-white border border-slate-200 p-4">
    <h3 class="font-semibold mb-2">Example Policy Sensitivity</h3>
    <p class="text-sm text-slate-700">
      A 10 kW rooftop system producing 15,000 kWh/year in a region with a $0.20/kWh buy rate:
    </p>
    <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
      <li>At <strong>1:1 Net Metering</strong> ‚Üí near net-zero bill; payback ‚âà 7 years.</li>
      <li>At <strong>50% Export Credit</strong> ‚Üí ~20% higher payback time; hybrid system recommended.</li>
      <li>At <strong>25% Export Credit</strong> ‚Üí battery storage nearly essential for economic parity.</li>
    </ul>
  </div>

  <p class="text-xs text-slate-500">
    Content adapted for educational comparison; use time-series simulators and verified utility tariffs 
    for final financial modeling.
  </p>
    </section>

    <!-- Tool -->
    <section id="panel-tool" class="hidden space-y-4">
      <h2 class="text-xl font-semibold">Solar Sizing & Cost Tool (Net-Zero vs Off-Grid)</h2>

     <p class="text-slate-700 space-y-2">
  This interactive calculator compares the <strong>levelized cost of electricity (LCOE)</strong> 
  for on-grid and off-grid systems and estimates net-metering outcomes.
  Enter your array size, production, load, and cost assumptions ‚Äî then test 
  <strong>buy/sell rates</strong> to see how policy changes affect your annual bill.

  <!-- How to Use the Calculator Tool -->
<div class="rounded-xl bg-white border border-slate-200 p-5 space-y-3 mt-6">
  <h3 class="text-lg font-semibold text-slate-800">How to Use the Calculator Tool</h3>
  <p class="text-slate-700 text-sm">
    This section describes what each variable means and where to find the values you‚Äôll need for the calculator.
    It follows the spreadsheet tabs: <strong>Inputs</strong>, <strong>Definitions</strong>, <strong>Calculations</strong>, 
    <strong>NetMetering</strong>, and <strong>Examples</strong>.
    <a href="https://docs.google.com/spreadsheets/d/12FqZ9YDAah15jWPssPiA9imxBu3CvhvGLWp66T1pM1I/edit?usp=sharing" 
         target="_blank" rel="noopener" 
         class="underline text-sky-700 hover:text-sky-900">
         View Tool Working ‚Üí
      </a>
  </p>

  <ul class="list-disc pl-6 text-sm text-slate-700 space-y-1">
    <li><strong>Array Size (kW):</strong> Total PV capacity ‚Äî use your installer‚Äôs quote or system design target.</li>
    <li><strong>Annual Load (kWh):</strong> Yearly household or facility electricity use from your utility bills.</li>
    <li><strong>Irradiance (kWh/m¬≤/day):</strong> Local solar potential from NREL PVWatts or Global Solar Atlas.</li>
    <li><strong>Performance Ratio (PR):</strong> Accounts for inverter and wiring losses; typically 0.75‚Äì0.85.</li>
    <li><strong>Battery Capacity (kWh):</strong> Total usable storage; multiply nominal by depth of discharge (DoD).</li>
    <li><strong>Buy Rate ($/kWh):</strong> Grid electricity price from your tariff.</li>
    <li><strong>Sell Credit ($/kWh):</strong> Rate paid for exports under your net-metering policy.</li>
    <li><strong>CAPEX(Capital Expenditure):</strong> Total installed cost including modules, inverter, battery, and <em>BOS</em> (Balance of System).</li>
    <li><strong>O&M:</strong> Annual operating and maintenance cost, usually 1‚Äì2% of CAPEX.</li>
    <li><strong>CRF (Capital Recovery Factor):</strong> Converts upfront CAPEX to an annualized cost based on discount rate and lifetime.</li>
    <li><strong>LCOE (Levelized Cost of Electricity):</strong> Average lifetime cost per kWh produced.</li>
  </ul>

  <p class="text-xs text-slate-500">
    Tip: You can estimate irradiance and performance ratio using free tools like PVWatts, and obtain buy/sell rates directly from your utility tariff sheet.
  </p>
</div>

       
  <br><br>
  Outputs include:
  <ul class="list-disc pl-6 text-slate-700 text-sm space-y-1">
    <li>On-grid and off-grid <strong>LCOE</strong></li>
    <li><strong>CAPEX</strong> estimates and cost ratios</li>
    <li>Import/export energy balance</li>
    <li>Net-metering bill or credit outcome</li>
  </ul>

  <div class="mt-4 space-y-1 text-sm">
    <p>üìÑ <strong>View the underlying assumptions sheet:</strong><br>
      <a href="https://docs.google.com/spreadsheets/d/1jTrXFmLzXCy0TXIiw_XwlHJ2nB2sb2O998to0cD4x3Q/edit?usp=sharing" 
         target="_blank" rel="noopener" 
         class="underline text-sky-700 hover:text-sky-900">
         Open Google Sheet ‚Üí
      </a>
    </p>

    <p>üßÆ <strong>See the live calculator logic:</strong><br>
      <a href="https://docs.google.com/spreadsheets/d/12FqZ9YDAah15jWPssPiA9imxBu3CvhvGLWp66T1pM1I/edit?usp=sharing" 
         target="_blank" rel="noopener" 
         class="underline text-sky-700 hover:text-sky-900">
         View Tool Working ‚Üí
      </a>
    </p>

    <p>üíª <strong>Access the GitHub repository:</strong><br>
      <a href="https://github.com/OneCommunityGlobal/SolarCostAnalysisTool" 
         target="_blank" rel="noopener" 
         class="underline text-sky-700 hover:text-sky-900">
         GitHub ‚Üí
      </a>
      <br>
      Once inside GitHub, click the <em>‚ÄúCode‚Äù</em> green button ‚Üí select 
      <strong>Download ZIP</strong> to get all the website HTML files.
    </p>

    <p>üé¨ <strong>Watch the demo video:</strong><br>
      <a href="https://www.dropbox.com/scl/fi/ljhqksvkgxvkbx44cfdj8/Tool_demo.mp4?rlkey=rjb6jfobi8301x85baz7qxpwe&st=r45p3n5y&dl=0" 
         target="_blank" rel="noopener" 
         class="underline text-sky-700 hover:text-sky-900">
         Demo Video ‚Üí
      </a>
    </p>

    <p>üåê <strong>Visit the full educational page:</strong><br>
      <a href="https://onecommunityglobal.org/solar-energy-microgrid-setup-maintenance/" 
         target="_blank" rel="noopener" 
         class="underline text-sky-700 hover:text-sky-900">
         One Community ‚Äì Solar Energy Microgrid Setup and Maintenance ‚Üí
      </a>
    </p>
  </div>

  <p class="text-xs text-slate-500 mt-4">
    These external links provide open-source documentation, spreadsheets, and visual references for the Solar Cost Analysis Tool. 
    Use them to trace how assumptions, costs, and energy data flow through the underlying model.
  </p>
</p>


      <div class="hint rounded-xl p-4 text-sm text-slate-700">
        <p class="font-semibold mb-2">How to find each input:</p>
        <ul class="list-disc pl-5 space-y-1">
          <li><span class="font-semibold">Load (kWh):</span> Use last 12 months of utility bills; sum kWh (or compute average daily = annual/365). Off-grid cabins: estimate from appliances √ó hours/day.</li>
          <li><span class="font-semibold">Solar irradiance (kWh/m¬≤/day):</span> Use PVWatts (NREL) or Global Solar Atlas for your location. The tool multiplies by a Performance Ratio for losses.</li>
          <li><span class="font-semibold">Distance from grid & $/ft:</span> Ask the utility/contractor for line extension quote; rural overhead vs underground differs widely.</li>
          <li><span class="font-semibold">Panel details:</span> Module nameplate watts and price per module (or per W). Enter both; we‚Äôll compute module count and installed $/W.</li>
          <li><span class="font-semibold">Battery:</span> Enter nominal voltage, Ah per battery (or kWh per unit), days of autonomy, DoD, and $/kWh (or pack price/size). Tool sizes bank kWh and estimates cost.</li>
          <li><span class="font-semibold">Inverter:</span> Peak kW needed (sum of coincident loads + surge factor) and $/kW. Off-grid inverters often cost more.</li>
          <li><span class="font-semibold">Buy/Sell rates:</span> Your tariff‚Äôs import rate and export credit (or tariff-specific $/kWh).</li>
          <li><span class="font-semibold">Installation:</span> Lump-sum labor/permits/inspection; add BOS if not in panel price.</li>
        </ul>
      </div>

      <div id="tool-root"></div>
      <p class="text-xs text-slate-500">Values last updated: <span id="updated-at">‚Äî</span></p>
    </section>
  </main>

  <footer class="mx-auto container-narrow px-6 pb-10 text-xs text-slate-500">
    Content adapted for educational comparison; use time-series tools and utility tariffs for final design.
  </footer>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tabs logic + last-updated date -->
  <script>
    const UPDATED_AT = new Date().toISOString().slice(0,10);
    const ua = document.getElementById('updated-at');
    if (ua) ua.textContent = UPDATED_AT;

    const tabButtons = document.querySelectorAll('#tabs .tab-btn');
    const panels = {
      overview: document.getElementById('panel-overview'),
      net: document.getElementById('panel-net'),
      cases: document.getElementById('panel-cases'),
      policy: document.getElementById('panel-policy'),
      tool: document.getElementById('panel-tool'),
    };
    function showTab(name){
      Object.entries(panels).forEach(([k,el]) => el.classList.toggle('hidden', k!==name));
      tabButtons.forEach(b => b.setAttribute('aria-selected', b.dataset.tab===name ? 'true':'false'));
      if(name==='tool' && !window.__toolMounted){ mountTool(); window.__toolMounted=true; }
      window.scrollTo({top:0,behavior:'smooth'});
    }
    tabButtons.forEach(b=>b.addEventListener('click',()=>showTab(b.dataset.tab)));
    showTab('overview');
  </script>

  <!-- Calculator (JSX run by Babel) -->
  <script type="text/babel">
    const {useMemo, useState} = React;

    // Small helpers
    const clampPos = (v, def=0)=>Number.isFinite(v) && v>=0 ? v : def;
    const CRF = (r,n)=>{ const rr=r; if(rr===0) return 1/Math.max(n,1); const t=Math.pow(1+rr,Math.max(n,1)); return (rr*t)/(t-1); };

    function App(){
      // ---------- Inputs ----------
      const [i, setI] = useState({
        // 1) Load
        annualLoadKWh: 10950,                 // or set avgDailyKWh; we sync both
        avgDailyKWh: 30,

        // 2) Location irradiance + losses
        irradiancePSH: 4.5,                   // kWh/m¬≤/day ‚âà peak sun hours
        performanceRatio: 0.75,               // wiring/temp/soiling/inverter

        // 3) Grid distance economics
        distanceFromGridFt: 800,
        costPerFoot: 20,

        // 4) Panels (size & cost) + BOS + install
        panelWatt: 400,                       // W per module
        panelPriceUSD: 180,                   // $ per module
        bosCostPerW: 0.6,                     // racking/wire/etc, $/Wdc
        installLumpSum: 3000,                 // permits/labor if not in $/W
        oversizeFactorOffGrid: 1.2,           // PV uplift for charging/seasonal

        // 5) Battery (V, Ah, DoD, $/kWh, days autonomy, eff)
        battVoltage: 48,                      // V (nominal bank)
        battAhPerUnit: 100,                   // Ah per unit (for info)
        battDoD: 80,                          // %
        battDaysAutonomy: 2,                  // days
        battRoundTripEff: 0.9,                // fraction
        batteryCostPerKWh: 350,               // $/kWh (rated kWh)

        // 6) Inverter (size & $/kW)
        inverterBuyKW: 10,                    // grid-tie inverter size (‚âà PV kW)
        inverterCostPerKW: 180,               // grid-tie $/kW
        inverterOffGridKW: 8,                 // off-grid inverter/charger size
        inverterOffGridCostPerKW: 450,        // off-grid $/kW

        // 7) Grid buy/sell
        buyRate: 0.20,                        // $/kWh
        sellRate: 0.10,                       // $/kWh credit

        // 8) Financials
        discountRatePct: 6,
        analysisYears: 25,
        onmPctOfCapex: 1.0,                   // %/yr for PV/BOS/inverters
        generatorReservePerYear: 200          // off-grid annual reserve
      });

      // Keep daily/annual in sync gently
      const set = (k,v)=>{
        setI(s=>{
          const n = {...s,[k]:v};
          if(k==='annualLoadKWh') n.avgDailyKWh = clampPos(v/365, s.avgDailyKWh);
          if(k==='avgDailyKWh')   n.annualLoadKWh = clampPos(v*365, s.annualLoadKWh);
          return n;
        });
      };

      // ---------- Derived sizing ----------
      const out = useMemo(()=>{
        // Sanitize
        const annualLoad = clampPos(i.annualLoadKWh);
        const dailyLoad  = clampPos(i.avgDailyKWh);
        const PR         = Math.min(Math.max(i.performanceRatio,0.4),0.9);
        const PSH        = Math.max(i.irradiancePSH, 1e-6);  // kWh/m¬≤/day ‚âà sun hours

        // Energy yield per 1 kWdc per year
        const kWhPerKWyr = PSH * PR * 365;

        // ---- Net-zero grid-tie array size ----
        const pvKW_netzero = clampPos(annualLoad / Math.max(kWhPerKWyr,1e-6));
        const modules_net  = Math.ceil((pvKW_netzero*1000) / Math.max(i.panelWatt,1));
        const panelsCost_net = modules_net * clampPos(i.panelPriceUSD);
        const bosCost_net    = (pvKW_netzero*1000) * clampPos(i.bosCostPerW);
        const inverterKW_net = Math.max(i.inverterBuyKW, pvKW_netzero); // allow user override but ensure >= array
        const inverterCost_net = inverterKW_net * clampPos(i.inverterCostPerKW);
        const gridExtension = clampPos(i.distanceFromGridFt) * clampPos(i.costPerFoot);
        const capex_net = panelsCost_net + bosCost_net + inverterCost_net + clampPos(i.installLumpSum) + gridExtension;

        // Production for billing at net-zero sizing (‚âà equals annual load)
        const annualProd_net = pvKW_netzero * kWhPerKWyr;
        const exportKWh_net = Math.max(0, annualProd_net - annualLoad);
        const importKWh_net = Math.max(0, annualLoad - annualProd_net);
        const annualBill_net = importKWh_net*i.buyRate - exportKWh_net*i.sellRate;

        // ---- Off-grid battery sizing ----
        // Required usable storage for autonomy days:
        const usableKWh_needed = dailyLoad * Math.max(i.battDaysAutonomy,0);
        // Rated bank kWh accounting for DoD and round-trip efficiency:
        const battDoD = Math.min(Math.max(i.battDoD/100, 0.3), 0.95);
        const rtEff   = Math.min(Math.max(i.battRoundTripEff, 0.7), 1);
        const bankRatedKWh = usableKWh_needed / Math.max(battDoD*rtEff, 1e-6);

        // Convert voltage/Ah info (for display only)
        const unitKWh_fromVAh = (i.battVoltage * i.battAhPerUnit)/1000; // kWh per "unit"
        const estUnits = unitKWh_fromVAh > 0 ? Math.ceil(bankRatedKWh / unitKWh_fromVAh) : 0;

        const batteryCapex = bankRatedKWh * clampPos(i.batteryCostPerKWh);

        // ---- Off-grid PV & inverter ----
        // Off-grid PV sized for daily load with oversize to charge bank & seasonal headroom
        const pvKW_off = clampPos( (dailyLoad * i.oversizeFactorOffGrid) / Math.max(PSH*PR,1e-6) );
        const modules_off = Math.ceil((pvKW_off*1000) / Math.max(i.panelWatt,1));
        const panelsCost_off = modules_off * clampPos(i.panelPriceUSD);
        const bosCost_off    = (pvKW_off*1000) * clampPos(i.bosCostPerW);
        const inverterKW_off = Math.max(i.inverterOffGridKW, dailyLoad/4); // rough guard; user controls this
        const inverterCost_off = inverterKW_off * clampPos(i.inverterOffGridCostPerKW);
        const capex_off = panelsCost_off + bosCost_off + inverterCost_off + batteryCapex + clampPos(i.installLumpSum); // no grid extension

        // ---- LCOE math (annualized cost / annual energy) ----
        const r = Math.max(i.discountRatePct/100, 0);
        const N = Math.max(Math.round(i.analysisYears), 1);
        const crf = CRF(r,N);

        const onmPct = Math.max(i.onmPctOfCapex/100,0);

        const annualOandM_net = onmPct*capex_net;
        const annualized_net  = capex_net*crf + annualOandM_net;
        const lcoe_net = annualized_net / Math.max(annualProd_net,1);

        // Battery replacement treatment: approximate via CRF on bank with life = min(N, lifeGuess)
        const battLifeGuess = 12; // you can expose if desired
        const battCRF = CRF(r, Math.min(N, battLifeGuess));
        const annualOandM_off = onmPct*(capex_off - batteryCapex) + clampPos(i.generatorReservePerYear);
        const annualized_off  = (capex_off - batteryCapex)*crf + (batteryCapex*battCRF) + annualOandM_off;
        const annualProd_off  = pvKW_off * kWhPerKWyr; // average-year energy available
        const lcoe_off = annualized_off / Math.max(annualProd_off,1);

        return {
          // Net-zero
          pvKW_netzero, modules_net, inverterKW_net,
          panelsCost_net, bosCost_net, inverterCost_net, gridExtension, capex_net,
          annualProd_net, exportKWh_net, importKWh_net, annualBill_net,

          // Off-grid
          pvKW_off, modules_off, inverterKW_off,
          bankRatedKWh, estUnits, batteryCapex, panelsCost_off, bosCost_off, inverterCost_off, capex_off,

          // LCOE
          lcoe_net, lcoe_off,
          ratio: lcoe_off / Math.max(lcoe_net,1e-9),

          // Common
          kWhPerKWyr, unitKWh_fromVAh
        };
      }, [i]);

      // ---------- UI bits ----------
      const Field = ({ label, suffix, step = 0.01, min = 0, value, onChange, title }) => (
        <label className="grid items-center gap-2 py-1 [grid-template-columns:1fr_8rem_5rem]" title={title||''}>
          <span className="text-sm text-slate-600">{label}</span>
          <input type="number" step={step} min={min}
                 value={Number.isFinite(value) ? value : ''}
                 onChange={(e)=>onChange(parseFloat(e.target.value))}
                 className="h-9 w-full rounded-md border border-slate-300 px-2 text-right"/>
          {suffix && <span className="text-xs text-slate-500 text-left">{suffix}</span>}
        </label>
      );

      const Card = ({title,children}) => (
        <div className="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 className="mb-3 text-lg font-semibold text-slate-800">{title}</h3>
          {children}
        </div>
      );

      const Stat = ({label,value,unit=''}) => (
        <div className="flex flex-col rounded-xl bg-slate-50 p-3 text-center">
          <div className="text-2xl font-semibold text-slate-800">
            {isFinite(value) ? value.toLocaleString(undefined,{maximumFractionDigits:3}) : '‚Äî'}{unit}
          </div>
          <div className="text-xs text-slate-500">{label}</div>
        </div>
      );

      return (
        <div className="space-y-6">
          <p className="text-sm text-slate-600">
            Enter your load, irradiance, component details, and grid economics. The tool sizes a
            <b> net-zero grid-tie</b> array and an <b>off-grid</b> PV + battery system, then compares CAPEX and LCOE.
          </p>

          {/* Input groups */}
          <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
            <Card title="1) Load">
              <Field label="Annual Load" suffix="kWh/yr" value={i.annualLoadKWh} onChange={v=>set('annualLoadKWh',v)} />
              <Field label="Avg Daily Load" suffix="kWh/day" value={i.avgDailyKWh} onChange={v=>set('avgDailyKWh',v)} />
            </Card>

            <Card title="2) Site Solar">
              <Field label="Irradiance (PSH)" suffix="kWh/m¬≤/day" value={i.irradiancePSH} onChange={v=>set('irradiancePSH',v)}
                     title="Peak Sun Hours ‚âà average kWh/m¬≤/day" />
              <Field label="Performance Ratio" suffix="0‚Äì1" step={0.01} value={i.performanceRatio} onChange={v=>set('performanceRatio',v)} />
              <div className="text-xs text-slate-500 mt-2">
                Yield per 1 kW: {out.kWhPerKWyr.toFixed(0).toLocaleString()} kWh/yr
              </div>
            </Card>

            <Card title="3) Grid Distance">
              <Field label="Distance from Grid" suffix="ft" value={i.distanceFromGridFt} onChange={v=>set('distanceFromGridFt',v)} />
              <Field label="Cost per Foot" suffix="$ / ft" value={i.costPerFoot} onChange={v=>set('costPerFoot',v)} />
            </Card>
          </div>

          <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
            <Card title="4) Panels & Install">
              <Field label="Panel Size" suffix="W" value={i.panelWatt} onChange={v=>set('panelWatt',v)} />
              <Field label="Panel Price" suffix="$ / panel" value={i.panelPriceUSD} onChange={v=>set('panelPriceUSD',v)} />
              <Field label="BOS Cost" suffix="$ / Wdc" value={i.bosCostPerW} onChange={v=>set('bosCostPerW',v)} />
              <Field label="Install (lump sum)" suffix="$" value={i.installLumpSum} onChange={v=>set('installLumpSum',v)} />
              <Field label="Off-Grid PV Oversize" suffix="√ó" value={i.oversizeFactorOffGrid} onChange={v=>set('oversizeFactorOffGrid',v)} />
            </Card>

            <Card title="5) Battery Bank">
              <Field label="Bank Voltage" suffix="V" value={i.battVoltage} onChange={v=>set('battVoltage',v)} />
              <Field label="Ah per Battery (info)" suffix="Ah" value={i.battAhPerUnit} onChange={v=>set('battAhPerUnit',v)} />
              <Field label="Depth of Discharge" suffix="%" value={i.battDoD} onChange={v=>set('battDoD',v)} />
              <Field label="Days of Autonomy" suffix="days" step={1} value={i.battDaysAutonomy} onChange={v=>set('battDaysAutonomy',v)} />
              <Field label="Round-Trip Efficiency" suffix="0‚Äì1" value={i.battRoundTripEff} onChange={v=>set('battRoundTripEff',v)} />
              <Field label="Battery Cost" suffix="$ / kWh (rated)" value={i.batteryCostPerKWh} onChange={v=>set('batteryCostPerKWh',v)} />
            </Card>

            <Card title="6) Inverters">
              <Field label="Grid-Tie Inverter Size" suffix="kW" value={i.inverterBuyKW} onChange={v=>set('inverterBuyKW',v)} />
              <Field label="Grid-Tie Cost" suffix="$ / kW" value={i.inverterCostPerKW} onChange={v=>set('inverterCostPerKW',v)} />
              <Field label="Off-Grid Inverter Size" suffix="kW" value={i.inverterOffGridKW} onChange={v=>set('inverterOffGridKW',v)} />
              <Field label="Off-Grid Cost" suffix="$ / kW" value={i.inverterOffGridCostPerKW} onChange={v=>set('inverterOffGridCostPerKW',v)} />
            </Card>
          </div>

          <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
            <Card title="7) Buy/Sell & 8) Financials">
              <Field label="Buy Rate" suffix="$ / kWh" value={i.buyRate} onChange={v=>set('buyRate',v)} />
              <Field label="Sell Credit" suffix="$ / kWh" value={i.sellRate} onChange={v=>set('sellRate',v)} />
              <Field label="Discount Rate" suffix="%" value={i.discountRatePct} onChange={v=>set('discountRatePct',v)} />
              <Field label="Analysis Horizon" suffix="yrs" step={1} value={i.analysisYears} onChange={v=>set('analysisYears',v)} />
              <Field label="O&M" suffix="% of CAPEX / yr" value={i.onmPctOfCapex} onChange={v=>set('onmPctOfCapex',v)} />
              <Field label="Generator Reserve (off-grid)" suffix="$ / yr" value={i.generatorReservePerYear} onChange={v=>set('generatorReservePerYear',v)} />
            </Card>

            <Card title="Net-Zero Grid-Tie (Results)">
              <div className="grid grid-cols-2 gap-3">
                <Stat label="Array Size" value={out.pvKW_netzero} unit=" kW" />
                <Stat label="Modules" value={out.modules_net} />
                <Stat label="Inverter Size" value={out.inverterKW_net} unit=" kW" />
                <Stat label="Grid Extension" value={out.gridExtension} unit=" $" />
                <Stat label="CAPEX (all-in)" value={out.capex_net} unit=" $" />
                <Stat label="Annual Prod." value={out.annualProd_net} unit=" kWh/yr" />
                <Stat label="Annual Bill (‚àí credit)" value={out.annualBill_net} unit=" $" />
              </div>
              <div className="text-xs text-slate-500 mt-2">
                CAPEX = Panels + BOS + Inverter + Install + Grid Extension.
              </div>
            </Card>

            <Card title="Off-Grid (Results)">
              <div className="grid grid-cols-2 gap-3">
                <Stat label="PV Size" value={out.pvKW_off} unit=" kW" />
                <Stat label="Modules" value={out.modules_off} />
                <Stat label="Battery (rated)" value={out.bankRatedKWh} unit=" kWh" />
                <Stat label="Est. Battery Units" value={out.estUnits} />
                <Stat label="Inverter Size" value={out.inverterKW_off} unit=" kW" />
                <Stat label="Battery Cost" value={out.batteryCapex} unit=" $" />
                <Stat label="CAPEX (all-in)" value={out.capex_off} unit=" $" />
              </div>
              <div className="text-xs text-slate-500 mt-2">
                CAPEX = Panels + BOS + Off-Grid Inverter + Batteries + Install (no grid extension).
              </div>
            </Card>
          </div>

          <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
            <Card title="LCOE Comparison">
              <div className="grid grid-cols-3 gap-3">
                <Stat label="Net-Zero LCOE" value={out.lcoe_net} unit=" $/kWh" />
                <Stat label="Off-Grid LCOE" value={out.lcoe_off} unit=" $/kWh" />
                <Stat label="Off-Grid / Net-Zero" value={out.ratio} unit=" √ó" />
              </div>
              <p className="mt-3 text-xs text-slate-500">
                Annualized cost via capital recovery factor (CRF). Batteries are annualized with a 12-year replacement proxy.
              </p>
            </Card>

            <Card title="Cost Breakdown (Net-Zero)">
              <ul className="text-sm text-slate-700 space-y-1">
                <li>Panels: ${out.panelsCost_net.toLocaleString()}</li>
                <li>BOS: ${out.bosCost_net.toLocaleString()}</li>
                <li>Inverter: ${out.inverterCost_net.toLocaleString()}</li>
                <li>Install: ${i.installLumpSum.toLocaleString()}</li>
                <li>Grid Extension: ${out.gridExtension.toLocaleString()}</li>
              </ul>
            </Card>

            <Card title="Cost Breakdown (Off-Grid)">
              <ul className="text-sm text-slate-700 space-y-1">
                <li>Panels: ${out.panelsCost_off.toLocaleString()}</li>
                <li>BOS: ${out.bosCost_off.toLocaleString()}</li>
                <li>Off-Grid Inverter: ${out.inverterCost_off.toLocaleString()}</li>
                <li>Batteries: ${out.batteryCapex.toLocaleString()}</li>
                <li>Install: ${i.installLumpSum.toLocaleString()}</li>
              </ul>
            </Card>
          </div>

          <div className="text-xs text-slate-500">
            Notes: Uses annual averages; does not model hourly/seasonal tariffs or generator fuel. For engineering design, run time-series (e.g., PVWatts + tariff engine) and utility-specific interconnect rules.
          </div>
        </div>
      );
    }

    function mountTool(){
      const root = ReactDOM.createRoot(document.getElementById('tool-root'));
      root.render(<App />);
    }
  </script>
</body>
</html>
